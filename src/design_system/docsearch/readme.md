# Algolia DocSearch Ã— Latitude site
Latitude's search is powered by [Algolia DocSearch](https://community.algolia.com/docsearch/).


## Running the scraper
To populate the Algolia indices [`ComponentDocumentation_prod`](https://www.algolia.com/apps/2OIHB6I2ON/explorer/browse/ComponentDocumentation_prod) and [`ComponentDocumentation_dev`](https://www.algolia.com/apps/2OIHB6I2ON/explorer/browse/ComponentDocumentation_dev), we run the scraper provided by Algolia, as described [in their docs](https://community.algolia.com/docsearch/run-your-own.html#running-the-crawler-from-the-code-base). 

Currently, the scraper must be manually run whenever changes to Latitude components have been deployed to production in order to update the Algolia index. In the future, we'd like to implement this to automatically run in our deployment process ([THESEUS-433](https://flexport.atlassian.net/browse/THESEUS-443)).

The `APPLICATION_ID` is the same one Flexport uses and the API key can be obtained by talking to Backend Infra.

### Scraper config file
The config file is `algolia_docsearch_scraper_config.json`. When running the scraper, first run it with the index `ComponentDocumentation_dev` to verify that the resulting records are reasonable before switching to `ComponentDocumentation_prod`.

The available options in the config file are specified in Algolia's docs [here](https://community.algolia.com/docsearch/config-file.html).

Each url has `"_tags": ["public"]` because the Algolia API key generated by `algolia_authenticatable.rb` (and used by the Latitude site) sets a filter for `public`.

Certain elements in `design_system/documentation_layout` and `design_system/interfaces` have an `algolia-id` attribute which helps make the selectors in the config more specific. The demos and prop tables on the site are excluded from the index since they contain ample redundant information. Those elements have `algolia-id="docsearch-exclude"`.


## Improving search results
To improve the search results, we set the way results are sorted with `ranking`. An issue we had was that if the search query is `Text`, the `Text` component would not be in the top five results, which made that component's page difficult to find. This was because other components like `TextFilter` had the word "text" in both their headers and subheaders, so it ranked higher, whereas the `Text` component only had a single occurrence of the word in its header. To help mitigate this issue, the `words` ranking criteria (sort by decreasing number of matched query words) is set to be less important.


## Future improvements
Another performance improvement would be to implement the search dropdown without the DocSearch js package, since we already have the `AlgoliaInput` component ([THESEUS-492](https://flexport.atlassian.net/browse/THESEUS-492)).
